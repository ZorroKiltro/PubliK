#!/bin/bash
# ============================================================
# ğŸ” BUSCADOR DE PATRONES EN CÃ“DIGO FUENTE WEB
# Herramienta de Bug Bounty - Regex Hunter
# PatrÃ³n: 12 caracteres + punto + 1 carÃ¡cter
# Ejemplo de match: "AbCdEf123456.x" o "api_secret_key.js"
# ============================================================

# --- COLORES para output bonito en terminal ---
ROJO='\033[0;31m'
VERDE='\033[0;32m'
AMARILLO='\033[1;33m'
CYAN='\033[0;36m'
BLANCO='\033[1;37m'
RESET='\033[0m'

# --- BANNER ---
echo -e "${CYAN}"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘       ğŸ”  REGEX PATTERN HUNTER           â•‘"
echo "â•‘     Bug Bounty Automation Tool           â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "${RESET}"

# ============================================================
# CONFIGURACIÃ“N - Modifica estas variables segÃºn tu objetivo
# ============================================================

# La URL objetivo (pÃ¡sala como argumento o defÃ­nela aquÃ­)
URL="${1:-https://ejemplo.com}"

# El patrÃ³n regex que buscamos:
# .{12}   â†’ exactamente 12 caracteres de cualquier tipo
# \.      â†’ un punto LITERAL (el \ escapa el punto)
# .       â†’ cualquier carÃ¡cter despuÃ©s del punto
PATRON='.{12}\..{1}'

# Archivo temporal para guardar el HTML descargado
ARCHIVO_TEMP="/tmp/pagina_temp_$$.html"

# Archivo donde se guardan los resultados
ARCHIVO_RESULTADO="resultados_patron_$(date +%Y%m%d_%H%M%S).txt"

# ============================================================
# PASO 1: Descargar el cÃ³digo fuente de la pÃ¡gina
# ============================================================
echo -e "${AMARILLO}[*] Descargando cÃ³digo fuente de:${RESET} $URL"
echo -e "${AMARILLO}[*] Por favor espera...${RESET}\n"

# curl descarga la pÃ¡gina:
# -s = silencioso (sin barra de progreso)
# -L = sigue redirecciones (si la URL redirige a otra)
# -A = User-Agent para simular un navegador real
# --max-time = lÃ­mite de tiempo en segundos
curl -s -L \
     -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" \
     --max-time 15 \
     "$URL" -o "$ARCHIVO_TEMP"

# Verificar si la descarga fue exitosa
if [ ! -s "$ARCHIVO_TEMP" ]; then
    echo -e "${ROJO}[!] ERROR: No se pudo descargar la pÃ¡gina o estÃ¡ vacÃ­a${RESET}"
    echo -e "${ROJO}[!] Verifica la URL e intenta de nuevo${RESET}"
    exit 1
fi

TAMANIO=$(wc -c < "$ARCHIVO_TEMP")
echo -e "${VERDE}[âœ“] Descarga exitosa - ${TAMANIO} bytes obtenidos${RESET}\n"

# ============================================================
# PASO 2: Aplicar el patrÃ³n regex sobre el cÃ³digo descargado
# ============================================================
echo -e "${AMARILLO}[*] Buscando patrÃ³n: ${BLANCO}${PATRON}${RESET}"
echo -e "${AMARILLO}[*] (12 chars + punto + 1 char)${RESET}\n"

# grep con opciones:
# -o = muestra SOLO la parte que coincide (no toda la lÃ­nea)
# -E = modo Extended Regex (permite usar .{12} etc.)
# -P = modo Perl Regex (mÃ¡s potente, permite \w, \d, etc.)
# -n = muestra el nÃºmero de lÃ­nea donde se encontrÃ³

echo -e "${CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â• RESULTADOS â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"

# BÃºsqueda principal - extrae solo los matches exactos
RESULTADOS=$(grep -oP "$PATRON" "$ARCHIVO_TEMP")

if [ -z "$RESULTADOS" ]; then
    echo -e "${ROJO}[!] No se encontraron coincidencias con el patrÃ³n bÃ¡sico${RESET}"
else
    TOTAL=$(echo "$RESULTADOS" | wc -l)
    echo -e "${VERDE}[âœ“] Se encontraron ${BLANCO}${TOTAL}${VERDE} coincidencias:${RESET}\n"
    
    # Mostrar cada resultado con numeraciÃ³n
    echo "$RESULTADOS" | sort -u | nl -ba | while read num match; do
        echo -e "  ${CYAN}[$num]${RESET} ${BLANCO}$match${RESET}"
    done
fi

echo -e "\n${CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"

# ============================================================
# PASO 3: BÃºsquedas ADICIONALES mÃ¡s especÃ­ficas para Bug Bounty
# ============================================================
echo -e "\n${AMARILLO}[*] Ejecutando bÃºsquedas especializadas...${RESET}\n"

# --- 3a: Buscar posibles API Keys (alfanumÃ©rico + punto) ---
echo -e "${CYAN}ğŸ”‘ Posibles API Keys / Tokens:${RESET}"
grep -oP '[a-zA-Z0-9]{12}\.[a-zA-Z0-9]' "$ARCHIVO_TEMP" | sort -u | head -20
echo ""

# --- 3b: Buscar extensiones de archivos con 12 chars antes del punto ---
echo -e "${CYAN}ğŸ“ Posibles archivos/rutas:${RESET}"
grep -oP '\w{12}\.\w+' "$ARCHIVO_TEMP" | sort -u | head -20
echo ""

# --- 3c: Buscar dominios o subdominios con este patrÃ³n ---
echo -e "${CYAN}ğŸŒ Posibles subdominios/dominios:${RESET}"
grep -oP '[a-z0-9]{12}\.[a-z]{2,}' "$ARCHIVO_TEMP" | sort -u | head -20
echo ""

# --- 3d: Ver el contexto (lÃ­neas completas donde aparece el patrÃ³n) ---
echo -e "${CYAN}ğŸ“„ Contexto (lÃ­neas donde aparece el patrÃ³n):${RESET}"
grep -nP "$PATRON" "$ARCHIVO_TEMP" | head -10 | while IFS= read -r linea; do
    # Resaltar el patrÃ³n encontrado en la lÃ­nea
    echo -e "  ${AMARILLO}${linea}${RESET}"
done

# ============================================================
# PASO 4: Guardar todo en un archivo de reporte
# ============================================================
{
    echo "======================================"
    echo " REPORTE - REGEX PATTERN HUNTER"
    echo " Fecha: $(date)"
    echo " URL: $URL"
    echo " PatrÃ³n buscado: $PATRON"
    echo "======================================"
    echo ""
    echo "--- MATCHES EXACTOS DEL PATRÃ“N ---"
    grep -oP "$PATRON" "$ARCHIVO_TEMP" | sort -u
    echo ""
    echo "--- POSIBLES API KEYS ---"
    grep -oP '[a-zA-Z0-9]{12}\.[a-zA-Z0-9]' "$ARCHIVO_TEMP" | sort -u
    echo ""
    echo "--- POSIBLES ARCHIVOS ---"
    grep -oP '\w{12}\.\w+' "$ARCHIVO_TEMP" | sort -u
    echo ""
    echo "--- CONTEXTO COMPLETO (lÃ­neas) ---"
    grep -nP "$PATRON" "$ARCHIVO_TEMP"
} > "$ARCHIVO_RESULTADO"

echo -e "\n${VERDE}[âœ“] Reporte guardado en: ${BLANCO}${ARCHIVO_RESULTADO}${RESET}"

# ============================================================
# LIMPIEZA - Borrar archivo temporal
# ============================================================
rm -f "$ARCHIVO_TEMP"
echo -e "${VERDE}[âœ“] Limpieza completada${RESET}"
echo -e "\n${CYAN}Â¡Listo! Usa los resultados para analizar tu objetivo.${RESET}\n"

# ============================================================
# EJEMPLOS DE USO (descomenta para ver):
# ============================================================
# Para buscar solo letras y nÃºmeros antes del punto:
#   grep -oP '[a-zA-Z0-9]{12}\.[a-zA-Z0-9]' archivo.html
#
# Para incluir guiones y underscores:
#   grep -oP '[\w\-]{12}\.[\w]' archivo.html
#
# Para buscar con mÃ¡s de 1 char despuÃ©s del punto:
#   grep -oP '.{12}\.\w{3}' archivo.html  â† 3 chars despuÃ©s del punto
